pep-push
========

Proper Enterprise Platform

实现了 `pep-push-api` 中的公共内容

##消息推送流程参考
1. 业务端通过http方式，根据推送平台提供的接口，将“推送请求”推送服服务平台。
2. 推送服务器的webcontroller收到业务端的推送请求后，将“推送请求”加入到统一的消息队列中（JMS实现）。
3. 消息队列接收者从消息队列中取出“推送请求”，调用实际的推送服务类，推送消息。
4. 推送服务类根据消息的请求，查找用户与设备的对应关系，查找出要推送消息的设备相关信息。
5. 推送服务类遍历要推送的消息的设备信息，首先将推送的消息缓存到数据库中，然后调用实际的推送SDK(华为推送，小米推送，苹果推送，根据相关的设备信息可知具体的推送相关信息)向客户端推送消息，并根据SDK返回的结果设置数据库中缓存的消息的推送状态（推送成功还是失败）
6. 对应推送失败的消息，推送平台会启用定时任务重新推送消息，累计发送到一定次数后将不再推送。
7. 系统会定期删除数据库中指定天数之前的缓存的消息记录

## 配置文件参考

-  `conf/push/common/pushConfigs.js`
推送相关的统一的配置信息，因为配置的信息比较复杂，简单的properties文件满足不了要求，所以主要采用js的json格式来保存配置
使用`Nutz`框架相关的接口来读取这个文件，获取相关的配置信息。
具体的详细配置方法可以看pushConfigs.js中对应的注释

- `conf/push/common/vendor/apns/keystores`
ios推送sdk对应的推送.p12证书保存的目录,需要根据不同的项目设置不同的推送证书

- `conf/huawei/common/vendor/apns/keystores`
华为推送sdk对应的推送证书保存的目录，与ios推送证书不同，所有的项目可共用一个证书，所以不用配置

## 应用角标的实现原理

### 角标介绍
在推送通知栏消息时，可以带一个角标数字，>0时，应用程序图标显示未读消息数。=0时，清空对应的角标数

### android，ios角标接口的异同
ios推送，开放了角标相关接口，可以直接使用。
android端，角标和推送是分开发，需要自己实现推送角标的功能，需用用到透传消息（可以在收到推送后调用手机端设置角标接口）。android端可以显示角标的手机有华为手机，小米手机及其它开放角标接口的手机，需要在手机端推送代码中匹配不同的手机，以设置应用角标。

### android手机上角标功能具体实现方法
华为手机透传消息的到达率没有通知栏消息高，为了提高消息的到达率，所以实现角标的功能，需要结合通知栏消息与透传消息，在发送通知栏消息的同时，会发送一条带角标消息的命令消息，来设置角标。
在其它手机上，现在默认都是小米推送，通过一条透传消息的方式，在手机端显示未读消息及通知。
